<!DOCTYPE html>
<head>
	<title>Smartphone Controlled Pong</title>
	<style>
		div.player1
		{
			float: left;
		}
		div.player2
		{
			float: right;
		}
	</style>
	<script src="//davidshimjs.github.com/qrcodejs/qrcode.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		
		var io = io.connect();
		
		io.on('connect', function() {
			
			// Hacking function to create a class 
			function Player() {
				this.socket_id 	= null,
				this.rand_no 	= Math.random().toString(36).slice(2),
				this.ready 		= false;
				
				// Function to create and append a QR code.
				// Takes div as argument.
				this.appendQRCode = function(div) {
					var qrcode = new QRCode(div);
					qrcode.makeCode(window.location.href + io.id + '/' + this.rand_no);
				};
			};
			
			// create two obejcts for two players
			var player1 = new Player();
			var player2 = new Player();
			
			//Create two QR codes
			player1.appendQRCode("player1_qr");
			player2.appendQRCode("player2_qr");
			
			//#DEBUG 
			document.getElementById("player1_status").innerText = io.id + '/' + player1.rand_no;
			document.getElementById("player2_status").innerText = io.id + '/' + player2.rand_no;
			
			io.on('controller_connected', function(controller_socket_id, controller_rand_no) {
				
				if(player1.rand_no == controller_rand_no){
					
					player1.socket_id = controller_socket_id;
					player1.ready = true;
					document.getElementById("player1_status").innerText = "Connected";
				}
				
				else if(player2.rand_no == controller_rand_no){
					
					player2.socket_id = controller_socket_id;
					player2.ready = true;
					document.getElementById("player2_status").innerText = "Connected";
				}
			});
			
			io.on('controller_disconnect', function(controller_socket_id){
				
				if(player1.socket_id == controller_socket_id){
					
					player1.ready = true;
					document.getElementById("player1_status").innerText = "Disconnected";
				}
				
				if(player2.socket_id == controller_socket_id){
					
					player2.ready = false;
					document.getElementById("player2_status").innerText = "Disconnected";
				}
			});
		});
	</script>
</head>
<body>
	<div class="player1">
		<div id="player1_qr"></div>
		<div id="player1_status">Disconnected</div>
	</div>
	<div class="player2">
		<div id="player2_qr"></div>
		<div id="player2_status">Disconnected</div>
	</div>
</body>
</html>